<!DOCTYPE html>
<html>
<head>
  <title>Binary Tree Visualization</title>
  <style>
    /* Add your custom CSS styles for the tree visualization here */
    body {
      font-family: Arial, sans-serif;
      overflow-x: auto; /* Enable horizontal scrolling */
      white-space: nowrap; /* Prevent line breaks for the nodes */
    }

    .node-container {
      display: inline-block;
      margin: 10px;
    }

    .node {
      display: inline-block;
      border: 1px solid #000;
      padding: 5px 10px;
      margin: 5px;
      width: 200px; /* Set the width of the box to 200px */
      position: relative;
    }

    .arrow-down {
      position: absolute;
      bottom: -25px; /* Height of the arrow (50px) divided by 2 */
      left: 50%; /* Position arrow at the center horizontally */
      border-left: 2px solid #000;
      border-right: 2px solid #000;
      border-bottom: 50px solid #000;
      width: 0;
    }

    .divider {
      position: absolute;
      top: 50%; /* Position divider at the center vertically */
      left: 50%; /* Position divider at the center horizontally */
      width: 100px;
      height: 2px;
      background-color: #000;
      transform: translate(-50%, -50%); /* Center the divider */
    }
  </style>
</head>
<body>
  <div id="tree" class="node-container"></div>

  <script>
    async function getAndDrawTree() {
      try {
        const response = await fetch('https://income-mining.onrender.com/api/users/getChildNodes', {
          method: 'POST',
          headers: {
            'Content-Type': 'application/json',
          },
          body: JSON.stringify({
            "node_id": "64c00b6a849a379cc91b4ab4",
          }),
        });

        if (!response.ok) {
          throw new Error('Network response was not ok');
        }

        const data = await response.json();
        const nodes = data.nodes;

        // The 'nodes' array contains the nodes data received from the server.
        // You can now proceed to draw the binary tree using the 'nodes' array.

        const treeContainer = document.getElementById('tree');

        // Function to create a node element
        function createNodeElement(node) {
          const nodeElement = document.createElement('div');
          nodeElement.classList.add('node');
          nodeElement.textContent = node.name; // Display the name of the node

          if (node.left_child_id || node.right_child_id) {
            const leftArrow = document.createElement('div');
            leftArrow.classList.add('arrow-down');

            const leftDivider = document.createElement('div');
            leftDivider.classList.add('divider');

            nodeElement.appendChild(leftArrow);
            nodeElement.appendChild(leftDivider);

            if (node.left_child_id) {
              const leftChildNode = nodes.find(n => n._id === node.left_child_id);
              if (leftChildNode) {
                const leftChildElement = createNodeElement(leftChildNode);
                nodeElement.appendChild(leftChildElement);
              }
            }

            if (node.right_child_id) {
              const rightArrow = document.createElement('div');
              rightArrow.classList.add('arrow-down');

              const rightDivider = document.createElement('div');
              rightDivider.classList.add('divider');

              nodeElement.appendChild(rightArrow);
              nodeElement.appendChild(rightDivider);

              const rightChildNode = nodes.find(n => n._id === node.right_child_id);
              if (rightChildNode) {
                const rightChildElement = createNodeElement(rightChildNode);
                nodeElement.appendChild(rightChildElement);
              }
            }
          }

          return nodeElement;
        }

        // Check if there are any nodes in the response
        if (nodes.length > 0) {
          const rootNode = nodes.find(n => n.parent_id === null);
          if (rootNode) {
            const tree = createNodeElement(rootNode);
            treeContainer.appendChild(tree);
          } else {
            console.error('Root node not found in the nodes array.');
          }
        } else {
          console.error('No nodes data received from the server.');
        }

      } catch (err) {
        console.error('Error:', err.message);
      }
    }

    // Call the function to get and draw the binary tree when the page loads
    window.addEventListener('load', () => {
      getAndDrawTree();
    });
  </script>
</body>
</html>
